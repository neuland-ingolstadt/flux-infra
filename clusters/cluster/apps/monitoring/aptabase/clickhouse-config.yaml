apiVersion: v1
kind: ConfigMap
metadata:
  name: aptabase-clickhouse-config
  namespace: monitoring
data:
  memory.xml: |
    <clickhouse>
        <!--
          Limit total server memory usage so ClickHouse cannot grow without bound.
          This is an internal ClickHouse limit, not a Kubernetes pod limit.
        -->
        <max_server_memory_usage>536870912</max_server_memory_usage> <!-- 512MiB -->
        <max_server_memory_usage_to_ram_ratio>0.8</max_server_memory_usage_to_ram_ratio>

        <!--
          Reduce caches which are the main source of baseline memory usage.
          Defaults are quite large (hundreds of MiB or more); these values are
          tuned down to keep steadyâ€‘state usage lower for a small deployment.
        -->
        <mark_cache_size>134217728</mark_cache_size> <!-- 128MiB -->
        <uncompressed_cache_size>134217728</uncompressed_cache_size> <!-- 128MiB -->
    </clickhouse>


