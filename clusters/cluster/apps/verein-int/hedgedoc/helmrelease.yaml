---
apiVersion: source.toolkit.fluxcd.io/v1
kind: HelmRepository
metadata:
  name: nicholaswilde
  namespace: verein-int
spec:
  interval: 24h
  url: https://nicholaswilde.github.io/helm-charts
---
apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: hedgedoc
  namespace: verein-int
spec:
  interval: 30m
  chart:
    spec:
      chart: hedgedoc
      sourceRef:
        kind: HelmRepository
        name: nicholaswilde
        namespace: verein-int
      interval: 12h
  values:
    ingress:
      enabled: false
    persistence:
      config:
        enabled: true
        storageClass: longhorn
        size: 1Gi
    mariadb:
      enabled: true
    env:
      - name: CMD_DOMAIN
        value: "pad.eggl.one"
      - name: CMD_PROTOCOL_USESSL
        value: "true"
      - name: CMD_OAUTH2_CLIENT_ID
        valueFrom:
          secretKeyRef:
            name: hedgedoc-secrets
            key: OAUTH2_CLIENT_ID
      - name: CMD_OAUTH2_CLIENT_SECRET
        valueFrom:
          secretKeyRef:
            name: hedgedoc-secrets
            key: OAUTH2_CLIENT_SECRET
      - name: CMD_OAUTH2_AUTHORIZATION_URL
        value: "https://auth.eggl.one/application/o/authorize/"
      - name: CMD_OAUTH2_TOKEN_URL
        value: "https://auth.eggl.one/application/o/token/"
      - name: CMD_OAUTH2_USER_PROFILE_URL
        value: "https://auth.eggl.one/application/o/userinfo/"
      - name: CMD_OAUTH2_PROVIDERNAME
        value: "Authentik"
      - name: CMD_ALLOW_ANONYMOUS
        value: "false"
      - name: CMD_EMAIL
        value: "false"
